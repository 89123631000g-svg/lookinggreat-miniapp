<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>LookingGreat</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin:0;
  font-family: system-ui;
  background:#fff;
}

.app {
  padding-bottom:80px;
}

.card {
  height:100vh;
  display:flex;
  flex-direction:column;
}

.images {
  flex:1;
  display:flex;
}

.images img {
  width:50%;
  object-fit:cover;
}

.likeBtn {
  position:absolute;
  bottom:100px;
  right:20px;
  background:#ffcc00;
  border-radius:50%;
  width:64px;
  height:64px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
  cursor:pointer;
}

.bottomNav {
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:70px;
  background:#fff;
  display:flex;
  justify-content:space-around;
  align-items:center;
  border-top:1px solid #eee;
}

.bottomNav div {
  text-align:center;
  font-size:22px;
}
</style>
</head>
<body>

<div class="app" id="feed"></div>

<div class="bottomNav">
  <div onclick="goHome()">üè†</div>
  <div onclick="goUpload()">‚ûï</div>
  <div onclick="goProfile()">üë§</div>
</div>

<script>
const API_BASE = "https://api.lookingreat.ru";
const tg = window.Telegram.WebApp;
tg.expand();

let tg_id = tg.initDataUnsafe?.user?.id || "999";

let loading = false;
let lastId = 999999999;

async function loadFeed() {
  if (loading) return;
  loading = true;

  const res = await fetch(`${API_BASE}/feed?tg_id=${tg_id}&before_id=${lastId}`);
  const data = await res.json();

  if (!data.ok) return;

  data.items.forEach(item => {
    lastId = item.id;

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <div class="images">
        <img src="${API_BASE}/r2/${item.photo_left_key}" />
        <img src="${API_BASE}/r2/${item.photo_right_key}" />
      </div>
      <div class="likeBtn" onclick="vote(${item.id}, this)">üëç</div>
    `;

    document.getElementById("feed").appendChild(card);
  });

  loading = false;
}

async function vote(pair_id, el) {
  el.style.background = "#00cc66";

  await fetch(`${API_BASE}/vote`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ tg_id, pair_id })
  });

  setTimeout(() => {
    window.scrollBy({ top: window.innerHeight, behavior:"smooth" });
  }, 600);
}

window.addEventListener("scroll", () => {
  if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
    loadFeed();
  }
});

function goHome(){ window.scrollTo(0,0); }
function goUpload(){ alert("–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∞—è"); }
function goProfile(){ alert("–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∞—è"); }

loadFeed();
</script>

</body>
</html>
